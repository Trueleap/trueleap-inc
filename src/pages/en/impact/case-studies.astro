---
import Page from '../../../layouts/Page.astro';
import { getPayload } from '../../../lib/payload';

const lang = 'en';
const cms = getPayload(Astro);
const page = await cms.globals.read<Record<string, unknown>>('case-studies-page');

const allStudies = await cms.collections.list<Record<string, unknown>>('case-studies');

const categories = (page?.categoryFilters as Array<Record<string, unknown>> | undefined) ?? [];
const featuredStudies = allStudies.filter((c) => c.featured);
---

<Page title="Case Studies" lang={lang}>
  <!-- Hero -->
  <section class="pt-32 pb-20 bg-cream relative overflow-hidden">
    <div class="absolute inset-0 grid-lines opacity-40"></div>
    <div class="max-w-7xl mx-auto px-6 relative z-10">
      <span class="text-caption text-muted mb-4 block">{page?.hero?.eyebrow}</span>
      <h1 class="text-display-xl text-charcoal mb-8">
        {page?.hero?.headline} <span class="display-serif">{page?.hero?.headlineAccent}</span>
      </h1>
      <p class="text-body-lg text-muted max-w-3xl">
        {page?.hero?.description}
      </p>
    </div>
  </section>

  <!-- Category Filter -->
  <section class="py-8 bg-white border-b border-border sticky top-20 z-30">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex flex-wrap gap-2">
        {categories.map((cat, i) => (
          <button class={`px-4 py-2 text-sm font-medium transition-colors ${i === 0 ? 'bg-charcoal text-white' : 'bg-cream text-muted hover:bg-charcoal hover:text-white'}`}>
            {typeof cat === 'string' ? cat : cat.text}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Case Studies -->
  <section class="py-16 bg-charcoal">
    <div class="max-w-7xl mx-auto px-6">
      <span class="text-caption text-primary-light mb-8 block">{page?.featuredTitle}</span>
      <div class="grid md:grid-cols-2 gap-8">
        {featuredStudies.map((study) => (
          <div class="p-8 rounded-2xl bg-charcoal-light border border-border-dark">
            <div class="flex items-center gap-2 mb-4">
              <span class="px-3 py-1 rounded-full bg-primary text-white text-xs font-medium">
                {study?.industry}
              </span>
              <span class="text-sm text-white/50">{study?.country}</span>
            </div>
            <h3 class="text-xl font-medium text-white mb-2">{study?.title}</h3>
            <p class="text-white/70 text-sm mb-6">{study?.subtitle}</p>

            <div class="grid grid-cols-3 gap-4 mb-6">
              {(study?.metrics ?? []).map((metric) => (
                <div>
                  <p class="text-2xl font-medium text-white">{metric?.value}</p>
                  <p class="text-xs text-white/50">{metric?.label}</p>
                </div>
              ))}
            </div>

            <blockquote class="pt-4 border-t border-border-dark">
              <p class="text-sm text-white/70 italic mb-2">"{study?.quote?.text}"</p>
              <cite class="text-xs text-white/50 not-italic">
                â€” {study?.quote?.attribution}, {study?.quote?.role}
              </cite>
            </blockquote>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- All Case Studies -->
  <section class="py-24 bg-white">
    <div class="max-w-7xl mx-auto px-6">
      <span class="text-caption text-primary mb-8 block">{page?.allTitle}</span>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {allStudies.map((study) => (
          <div class="card group">
            <div class="aspect-video bg-gradient-to-br from-primary-lighter/30 to-cream mb-6 flex items-center justify-center">
              <div class="text-center">
                <p class="text-xs text-muted">{study?.region}</p>
              </div>
            </div>

            <div class="flex items-center gap-2 mb-3">
              <span class="px-2 py-1 rounded-full bg-primary-lighter text-primary text-xs font-medium">
                {study?.industry}
              </span>
              <span class="text-xs text-muted">{study?.country}</span>
            </div>

            <h3 class="text-lg font-medium text-charcoal mb-2 group-hover:text-primary transition-colors" style="transition-duration: var(--duration-normal);">
              {study?.title}
            </h3>
            <p class="text-sm text-muted mb-4">{study?.subtitle}</p>

            <div class="grid grid-cols-3 gap-2 pt-4 border-t border-border">
              {(study?.metrics ?? []).slice(0, 3).map((metric) => (
                <div class="text-center">
                  <p class="text-sm font-medium text-charcoal">{metric?.value}</p>
                  <p class="text-xs text-muted">{metric?.label}</p>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-24 bg-cream border-t border-border">
    <div class="max-w-3xl mx-auto px-6 text-center">
      <h2 class="text-display-md text-charcoal mb-6">
        Ready to create your own success story?
      </h2>
      <p class="text-body-lg text-muted mb-8">
        Whether you're a government, NGO, or enterprise, we can help you design
        a deployment that achieves real impact for your community.
      </p>
      <div class="flex flex-wrap items-center justify-center gap-4">
        <a href="mailto:hello@trueleapinc.com" class="btn btn-primary">
          Get in Touch
        </a>
        <a href="/en/impact/network-map" class="btn btn-secondary">
          View Live Network
        </a>
      </div>
    </div>
  </section>
</Page>
